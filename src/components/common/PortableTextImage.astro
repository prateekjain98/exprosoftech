---
export interface Props {
  value?: {
    asset?: {
      url: string;
    };
    alt?: string;
    caption?: string;
  };
  node?: {
    asset?: {
      _ref?: string;
      url?: string;
    };
    alt?: string;
    caption?: string;
  };
}

const { value, node, ...props } = Astro.props;

// Try both value and node approaches (different astro-portabletext versions use different prop names)
const imageData = value || node;
const imageUrl = imageData?.asset?.url;

if (!imageUrl) {
  console.error(
    "PortableTextImage: No image URL found. Available props:",
    Object.keys(Astro.props)
  );
}
---

{
  imageUrl && (
    <figure class="my-8">
      <img
        src={imageUrl}
        alt={imageData?.alt || ""}
        loading="lazy"
        class="rounded-lg w-full h-auto"
      />
      {imageData?.caption && (
        <figcaption class="mt-2 text-center text-sm text-gray-500">
          {imageData.caption}
        </figcaption>
      )}
    </figure>
  )
}

